begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_package
package|package
name|org
operator|.
name|apache
operator|.
name|stanbol
operator|.
name|entityhub
operator|.
name|test
operator|.
name|query
package|;
end_package

begin_import
import|import static
name|junit
operator|.
name|framework
operator|.
name|Assert
operator|.
name|assertEquals
import|;
end_import

begin_import
import|import static
name|junit
operator|.
name|framework
operator|.
name|Assert
operator|.
name|assertFalse
import|;
end_import

begin_import
import|import static
name|junit
operator|.
name|framework
operator|.
name|Assert
operator|.
name|assertNotNull
import|;
end_import

begin_import
import|import static
name|junit
operator|.
name|framework
operator|.
name|Assert
operator|.
name|assertTrue
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Arrays
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Collections
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|HashSet
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Iterator
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Set
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|UUID
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Map
operator|.
name|Entry
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|stanbol
operator|.
name|commons
operator|.
name|testing
operator|.
name|http
operator|.
name|Request
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|stanbol
operator|.
name|commons
operator|.
name|testing
operator|.
name|http
operator|.
name|RequestExecutor
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|stanbol
operator|.
name|entityhub
operator|.
name|test
operator|.
name|it
operator|.
name|EntityhubTestBase
import|;
end_import

begin_import
import|import
name|org
operator|.
name|codehaus
operator|.
name|jettison
operator|.
name|json
operator|.
name|JSONArray
import|;
end_import

begin_import
import|import
name|org
operator|.
name|codehaus
operator|.
name|jettison
operator|.
name|json
operator|.
name|JSONException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|codehaus
operator|.
name|jettison
operator|.
name|json
operator|.
name|JSONObject
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|Test
import|;
end_import

begin_import
import|import
name|org
operator|.
name|slf4j
operator|.
name|Logger
import|;
end_import

begin_comment
comment|/**  *<p>  *  This tests do not depend on a specific dataset but only test  *</p>  *<ul>  *<li> Correct Errors on Illegal Requests  *<li> Missing but required parameter  *<li> Correct default values for optional parameters  *</ul>  *<p>  *  This set of tests should be tested against all service endpoints that  *  support queries. Typically this is done by extending this class  *  and configuring it to run against the according endpoint.  *</p><p>  *  Please make sure that the data set this tests are executed against does  *  not contain any information using the "http://www.test.org/test#"  *  namespace.  *</p>  * @author Rupert Westenthaler  *  */
end_comment

begin_class
specifier|public
specifier|abstract
class|class
name|QueryTestBase
extends|extends
name|EntityhubTestBase
block|{
specifier|public
specifier|static
specifier|final
name|String
name|RDFS_LABEL
init|=
literal|"http://www.w3.org/2000/01/rdf-schema#label"
decl_stmt|;
specifier|protected
specifier|final
name|String
name|endpointPath
decl_stmt|;
comment|/**      * Constructs a FieldQueryServiceTest      * @param servicePath the path to the service (e.g. /entityhub/sites/query)      * @param referencedSiteId if the       * @param log      */
specifier|public
name|QueryTestBase
parameter_list|(
name|String
name|servicePath
parameter_list|,
name|String
name|referencedSiteId
parameter_list|,
name|Logger
name|log
parameter_list|)
block|{
name|super
argument_list|(
name|referencedSiteId
operator|==
literal|null
condition|?
literal|null
else|:
name|Collections
operator|.
name|singleton
argument_list|(
name|referencedSiteId
argument_list|)
argument_list|,
name|log
argument_list|)
expr_stmt|;
if|if
condition|(
name|servicePath
operator|==
literal|null
condition|)
block|{
throw|throw
operator|new
name|IllegalArgumentException
argument_list|(
literal|"The path to the FieldQuery endpoint MUST NOT be NULL!"
argument_list|)
throw|;
block|}
if|if
condition|(
name|referencedSiteId
operator|!=
literal|null
condition|)
block|{
if|if
condition|(
operator|!
name|servicePath
operator|.
name|contains
argument_list|(
name|referencedSiteId
argument_list|)
condition|)
block|{
throw|throw
operator|new
name|IllegalArgumentException
argument_list|(
name|String
operator|.
name|format
argument_list|(
literal|"The parsed referenceSiteId %s is not contained within the parsed servicePath %s"
argument_list|,
name|referencedSiteId
argument_list|,
name|servicePath
argument_list|)
argument_list|)
throw|;
block|}
block|}
comment|//remove tailing '/'
if|if
condition|(
name|servicePath
operator|.
name|charAt
argument_list|(
name|servicePath
operator|.
name|length
argument_list|()
operator|-
literal|1
argument_list|)
operator|==
literal|'/'
condition|)
block|{
name|servicePath
operator|=
name|servicePath
operator|.
name|substring
argument_list|(
literal|0
argument_list|,
name|servicePath
operator|.
name|length
argument_list|()
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
comment|//we need a leading '/'
if|if
condition|(
name|servicePath
operator|.
name|charAt
argument_list|(
literal|0
argument_list|)
operator|!=
literal|'/'
condition|)
block|{
name|servicePath
operator|=
literal|'/'
operator|+
name|servicePath
expr_stmt|;
block|}
name|this
operator|.
name|endpointPath
operator|=
name|servicePath
expr_stmt|;
name|log
operator|.
name|info
argument_list|(
literal|"created FieldQueryTest for Service {}"
argument_list|,
name|servicePath
argument_list|)
expr_stmt|;
block|}
comment|/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -      *  Utility Methods      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -      */
comment|/**      * Executes a {@link QueryTestCase} by sending the       * {@link QueryTestCase#getContent() query} as an POST request to the       *<code>{@link #endpointPath}/{@link QueryTestCase#getServicePath()}</Code>.      * @param path the path to perform the field query. "/query" is added to the      * parsed value      * @param test the field query test      * @return the result executor used for the test      * @throws IOException on any exception while connecting to the entityhub      * @throws JSONException if the returned results are not valid JSON      */
specifier|protected
name|RequestExecutor
name|executeQuery
parameter_list|(
name|QueryTestCase
name|test
parameter_list|)
throws|throws
name|IOException
throws|,
name|JSONException
block|{
name|Request
name|request
init|=
name|builder
operator|.
name|buildPostRequest
argument_list|(
name|endpointPath
operator|+
name|test
operator|.
name|getServicePath
argument_list|()
argument_list|)
decl_stmt|;
for|for
control|(
name|Entry
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|header
range|:
name|test
operator|.
name|getHeaders
argument_list|()
operator|.
name|entrySet
argument_list|()
control|)
block|{
name|request
operator|.
name|withHeader
argument_list|(
name|header
operator|.
name|getKey
argument_list|()
argument_list|,
name|header
operator|.
name|getValue
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|request
operator|.
name|withContent
argument_list|(
name|test
operator|.
name|getContent
argument_list|()
argument_list|)
expr_stmt|;
return|return
name|executor
operator|.
name|execute
argument_list|(
name|request
argument_list|)
return|;
block|}
comment|/**      * Validates Results of a Query (/find or /query requests) based on the      * data defined by the test case      * @param re the {@link RequestExecutor} used for the test case      * @param test the query test case      * @throws JSONException in case the {@link RequestExecutor#getContent()} are      * no valid JSON. NOTE that the contents are only parsed if the      * {@link QueryTestCase#getExpectedStatus()} is a 2xx status code.      */
specifier|protected
name|void
name|assertQueryResults
parameter_list|(
name|RequestExecutor
name|re
parameter_list|,
name|QueryTestCase
name|test
parameter_list|)
throws|throws
name|JSONException
block|{
name|re
operator|.
name|assertStatus
argument_list|(
name|test
operator|.
name|getExpectedStatus
argument_list|()
argument_list|)
expr_stmt|;
name|re
operator|.
name|assertContentType
argument_list|(
literal|"application/json"
argument_list|)
expr_stmt|;
comment|//currently only application/json is supported
if|if
condition|(
operator|!
name|test
operator|.
name|expectsSuccess
argument_list|()
condition|)
block|{
return|return;
comment|//no further checks for tests that expect failure
block|}
name|JSONObject
name|jso
init|=
operator|new
name|JSONObject
argument_list|(
name|re
operator|.
name|getContent
argument_list|()
argument_list|)
decl_stmt|;
name|JSONArray
name|results
init|=
name|jso
operator|.
name|getJSONArray
argument_list|(
literal|"results"
argument_list|)
decl_stmt|;
if|if
condition|(
name|test
operator|.
name|expectesResults
argument_list|()
condition|)
block|{
name|assertTrue
argument_list|(
literal|"Missing Results for Query: \n "
operator|+
name|test
argument_list|,
name|results
operator|.
name|length
argument_list|()
operator|>
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|assertTrue
argument_list|(
literal|"Unexpected Results for Query:\n "
operator|+
name|test
argument_list|,
name|results
operator|.
name|length
argument_list|()
operator|==
literal|0
argument_list|)
expr_stmt|;
block|}
name|Set
argument_list|<
name|String
argument_list|>
name|expectedIds
decl_stmt|;
if|if
condition|(
name|test
operator|.
name|getExpectedResultIds
argument_list|()
operator|!=
literal|null
operator|&&
operator|!
name|test
operator|.
name|getExpectedResultIds
argument_list|()
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|expectedIds
operator|=
operator|new
name|HashSet
argument_list|<
name|String
argument_list|>
argument_list|(
name|test
operator|.
name|getExpectedResultIds
argument_list|()
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|expectedIds
operator|=
literal|null
expr_stmt|;
block|}
comment|//iterate over the results
comment|//General NOTE:
comment|//  use opt**(..) methods to avoid JSON Exception. We want to parse
comment|//  everything and than do asserts!
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|results
operator|.
name|length
argument_list|()
condition|;
name|i
operator|++
control|)
block|{
name|JSONObject
name|result
init|=
name|results
operator|.
name|getJSONObject
argument_list|(
name|i
argument_list|)
decl_stmt|;
name|String
name|id
init|=
name|result
operator|.
name|optString
argument_list|(
literal|"id"
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
literal|"ID missing for an Result"
argument_list|,
name|id
argument_list|)
expr_stmt|;
if|if
condition|(
name|expectedIds
operator|!=
literal|null
operator|&&
name|expectedIds
operator|.
name|remove
argument_list|(
name|id
argument_list|)
condition|)
block|{
comment|//not all results must be in the list
name|log
operator|.
name|info
argument_list|(
literal|"> expected result: {}"
argument_list|,
name|id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|log
operator|.
name|debug
argument_list|(
literal|"> result: {}"
argument_list|,
name|id
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|test
operator|.
name|getProhibitedResultIds
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|assertFalse
argument_list|(
literal|"Prohibited Result '"
operator|+
name|id
operator|+
literal|"' found!"
argument_list|,
name|test
operator|.
name|getProhibitedResultIds
argument_list|()
operator|.
name|contains
argument_list|(
name|id
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|Set
argument_list|<
name|String
argument_list|>
name|checkRequiredFields
decl_stmt|;
comment|//copy over the required fields
if|if
condition|(
name|test
operator|.
name|getRequiredFields
argument_list|()
operator|!=
literal|null
operator|&&
operator|!
name|test
operator|.
name|getRequiredFields
argument_list|()
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|checkRequiredFields
operator|=
operator|new
name|HashSet
argument_list|<
name|String
argument_list|>
argument_list|(
name|test
operator|.
name|getRequiredFields
argument_list|()
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|checkRequiredFields
operator|=
literal|null
expr_stmt|;
block|}
for|for
control|(
name|Iterator
argument_list|<
name|?
argument_list|>
name|keys
init|=
name|result
operator|.
name|keys
argument_list|()
init|;
name|keys
operator|.
name|hasNext
argument_list|()
condition|;
control|)
block|{
name|Object
name|key
init|=
name|keys
operator|.
name|next
argument_list|()
decl_stmt|;
comment|//process key
name|assertTrue
argument_list|(
literal|"Field "
operator|+
name|key
operator|+
literal|" is not an expected one"
argument_list|,
name|test
operator|.
name|getAllowedFields
argument_list|()
operator|.
name|contains
argument_list|(
name|key
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|checkRequiredFields
operator|!=
literal|null
operator|&&
name|checkRequiredFields
operator|.
name|remove
argument_list|(
name|key
argument_list|)
condition|)
block|{
name|log
operator|.
name|info
argument_list|(
literal|"     - required field {}"
argument_list|,
name|key
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|log
operator|.
name|debug
argument_list|(
literal|"     - optional field {}"
argument_list|,
name|key
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|checkRequiredFields
operator|!=
literal|null
condition|)
block|{
name|assertTrue
argument_list|(
literal|"Missing required Fields "
operator|+
name|checkRequiredFields
argument_list|,
name|checkRequiredFields
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|expectedIds
operator|!=
literal|null
condition|)
block|{
comment|// if there where expected results check that all where found
name|assertTrue
argument_list|(
literal|"The following expected results where missing in the Response: \n "
operator|+
name|expectedIds
argument_list|,
name|expectedIds
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
comment|/**      * Asserts that the Query is present in the response and if so returns the      * query      * @param content the returned content      * @return the query as contained in the response      * @throws JSONException on any Error while parsing the JSON query from the      * parsed content      */
specifier|protected
name|JSONObject
name|assertResponseQuery
parameter_list|(
name|String
name|content
parameter_list|)
throws|throws
name|JSONException
block|{
name|assertNotNull
argument_list|(
literal|"The content of the Response is NULL"
argument_list|,
name|content
argument_list|)
expr_stmt|;
name|JSONObject
name|jResult
init|=
operator|new
name|JSONObject
argument_list|(
name|content
argument_list|)
decl_stmt|;
name|JSONObject
name|jQuery
init|=
name|jResult
operator|.
name|optJSONObject
argument_list|(
literal|"query"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
literal|"Result does not contain the processed Query"
argument_list|,
name|jQuery
argument_list|)
expr_stmt|;
return|return
name|jQuery
return|;
block|}
comment|/**      * Asserts that the selected JSONArray of the field query returned within      * the result list contains parsed selected fields      * @param jQuery the query e.g. as returned by       * {@link #assertQueryResults(RequestExecutor, QueryTestCase)}      * @return the selected fields for further processing      * @throws JSONException on any error while parsing the JSON      */
specifier|protected
name|JSONArray
name|assertSelectedField
parameter_list|(
name|JSONObject
name|jQuery
parameter_list|,
name|String
modifier|...
name|selected
parameter_list|)
throws|throws
name|JSONException
block|{
name|Set
argument_list|<
name|String
argument_list|>
name|selectedSet
init|=
operator|new
name|HashSet
argument_list|<
name|String
argument_list|>
argument_list|()
decl_stmt|;
if|if
condition|(
name|selected
operator|==
literal|null
operator|||
name|selected
operator|.
name|length
operator|==
literal|0
condition|)
block|{
name|selectedSet
operator|=
name|Collections
operator|.
name|emptySet
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|selectedSet
operator|=
operator|new
name|HashSet
argument_list|<
name|String
argument_list|>
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
name|selected
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|JSONArray
name|jSelected
init|=
name|jQuery
operator|.
name|optJSONArray
argument_list|(
literal|"selected"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
literal|"Result Query is missing the 'selected' property"
argument_list|,
name|jSelected
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
literal|"Result Query is expected to have at least a single selected field"
argument_list|,
name|jSelected
operator|.
name|length
argument_list|()
operator|>
literal|0
argument_list|)
expr_stmt|;
name|boolean
name|found
init|=
literal|false
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|jSelected
operator|.
name|length
argument_list|()
operator|&&
operator|!
name|found
condition|;
name|i
operator|++
control|)
block|{
name|String
name|selectedField
init|=
name|jSelected
operator|.
name|optString
argument_list|(
name|i
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
literal|"Selected array contains a NULL element \n"
operator|+
name|jSelected
operator|.
name|toString
argument_list|(
literal|4
argument_list|)
argument_list|,
name|selectedField
argument_list|)
expr_stmt|;
name|selectedSet
operator|.
name|remove
argument_list|(
name|selectedField
argument_list|)
expr_stmt|;
block|}
name|assertTrue
argument_list|(
literal|"Fields "
operator|+
name|selectedSet
operator|+
literal|" are not selected by\n"
operator|+
name|jSelected
operator|.
name|toString
argument_list|(
literal|4
argument_list|)
argument_list|,
name|selectedSet
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
return|return
name|jSelected
return|;
block|}
comment|/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -      *  Find Query Test Methods:      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -      */
annotation|@
name|Test
specifier|public
name|void
name|testMissingNameParameter
parameter_list|()
throws|throws
name|IOException
throws|,
name|JSONException
block|{
name|FindQueryTestCase
name|test
init|=
operator|new
name|FindQueryTestCase
argument_list|(
literal|null
argument_list|,
literal|400
argument_list|)
decl_stmt|;
name|executeQuery
argument_list|(
name|test
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
specifier|public
name|void
name|testEmptyNameParameter
parameter_list|()
throws|throws
name|IOException
throws|,
name|JSONException
block|{
name|FindQueryTestCase
name|test
init|=
operator|new
name|FindQueryTestCase
argument_list|(
literal|""
argument_list|,
literal|400
argument_list|)
decl_stmt|;
name|executeQuery
argument_list|(
name|test
argument_list|)
expr_stmt|;
block|}
comment|/**      * Tests the defaults for the text constraint used for find queries. This      * includes:<ul>      *<li> limit set to an value> 0      *<li> offset set to 0      *<li> selected set to rdfs:label      *<li> constraint.patternType set to wildcard      *<li> constraint.field set to rdfs:label      *<li> constraint.type set to text      *</ul>      * @throws IOException      * @throws JSONException      */
annotation|@
name|Test
specifier|public
name|void
name|testDefaultsParameter
parameter_list|()
throws|throws
name|IOException
throws|,
name|JSONException
block|{
name|FindQueryTestCase
name|test
init|=
operator|new
name|FindQueryTestCase
argument_list|(
literal|"non_existant_"
operator|+
name|UUID
operator|.
name|randomUUID
argument_list|()
operator|.
name|toString
argument_list|()
argument_list|,
literal|false
argument_list|)
decl_stmt|;
name|RequestExecutor
name|re
init|=
name|executeQuery
argument_list|(
name|test
argument_list|)
decl_stmt|;
name|JSONObject
name|jQuery
init|=
name|assertResponseQuery
argument_list|(
name|re
operator|.
name|getContent
argument_list|()
argument_list|)
decl_stmt|;
name|assertTrue
argument_list|(
literal|"Result Query does not contain Limit property"
argument_list|,
name|jQuery
operator|.
name|has
argument_list|(
literal|"limit"
argument_list|)
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
literal|"Returned limit is<= 0"
argument_list|,
name|jQuery
operator|.
name|getInt
argument_list|(
literal|"limit"
argument_list|)
operator|>
literal|0
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
literal|"Result Query does not contain offset property"
argument_list|,
name|jQuery
operator|.
name|has
argument_list|(
literal|"offset"
argument_list|)
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
literal|"Returned offset is != 0"
argument_list|,
name|jQuery
operator|.
name|getInt
argument_list|(
literal|"offset"
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|assertSelectedField
argument_list|(
name|jQuery
argument_list|,
name|RDFS_LABEL
argument_list|)
expr_stmt|;
name|JSONArray
name|jConstraints
init|=
name|jQuery
operator|.
name|optJSONArray
argument_list|(
literal|"constraints"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
literal|"Result Query is missing the 'constraints' property"
argument_list|,
name|jConstraints
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"Result Query is expected to have a single constraint"
argument_list|,
literal|1
argument_list|,
name|jConstraints
operator|.
name|length
argument_list|()
argument_list|)
expr_stmt|;
name|JSONObject
name|constraint
init|=
name|jConstraints
operator|.
name|optJSONObject
argument_list|(
literal|0
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
literal|"'constraints' array does not contain a JSONObject but "
operator|+
name|jConstraints
operator|.
name|get
argument_list|(
literal|0
argument_list|)
argument_list|,
name|constraint
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"The 'type' of the Constraint is not 'text' but "
operator|+
name|constraint
operator|.
name|opt
argument_list|(
literal|"type"
argument_list|)
argument_list|,
literal|"text"
argument_list|,
name|constraint
operator|.
name|optString
argument_list|(
literal|"type"
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"The 'patternType' of the Constraint is not 'wildcard' but "
operator|+
name|constraint
operator|.
name|opt
argument_list|(
literal|"patternType"
argument_list|)
argument_list|,
literal|"wildcard"
argument_list|,
name|constraint
operator|.
name|optString
argument_list|(
literal|"patternType"
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"The 'field' of the Constraint is not rdfs:label but "
operator|+
name|constraint
operator|.
name|opt
argument_list|(
literal|"field"
argument_list|)
argument_list|,
name|RDFS_LABEL
argument_list|,
name|constraint
operator|.
name|optString
argument_list|(
literal|"field"
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
specifier|public
name|void
name|testCustomFieldParameter
parameter_list|()
throws|throws
name|IOException
throws|,
name|JSONException
block|{
name|FindQueryTestCase
name|test
init|=
operator|new
name|FindQueryTestCase
argument_list|(
literal|"non_existant_"
operator|+
name|UUID
operator|.
name|randomUUID
argument_list|()
operator|.
name|toString
argument_list|()
argument_list|,
literal|false
argument_list|)
decl_stmt|;
name|String
name|testField
init|=
literal|"http://www.test.org/test#test_"
operator|+
name|UUID
operator|.
name|randomUUID
argument_list|()
decl_stmt|;
name|test
operator|.
name|setField
argument_list|(
name|testField
argument_list|)
expr_stmt|;
name|RequestExecutor
name|re
init|=
name|executeQuery
argument_list|(
name|test
argument_list|)
decl_stmt|;
name|JSONObject
name|jQuery
init|=
name|assertResponseQuery
argument_list|(
name|re
operator|.
name|getContent
argument_list|()
argument_list|)
decl_stmt|;
name|assertSelectedField
argument_list|(
name|jQuery
argument_list|,
name|testField
argument_list|)
expr_stmt|;
block|}
comment|/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -      *  Field Query Test Methods:      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -      */
annotation|@
name|Test
specifier|public
name|void
name|testIllegalJSON
parameter_list|()
throws|throws
name|IOException
throws|,
name|JSONException
block|{
name|FieldQueryTestCase
name|test
init|=
operator|new
name|FieldQueryTestCase
argument_list|(
literal|"{"
operator|+
literal|"'selected': [ 'http:\\/\\/www.test.org\\/test#field'], "
operator|+
literal|"'constraints': [{ "
operator|+
literal|"'type': 'text', "
operator|+
literal|"'text': 'Paris' "
operator|+
comment|//NOTE: here the comma is missing here!
literal|"'patternType' : 'none', "
operator|+
literal|"'field': 'http:\\/\\/www.test.org\\/test#field', "
operator|+
literal|"'dataTypes': ['http:\\/\\/www.iks-project.eu\\/ontology\\/rick\\/model\\/text'] "
operator|+
literal|"}]"
operator|+
literal|"}"
argument_list|,
literal|400
argument_list|)
decl_stmt|;
comment|//expect BadRequest
comment|//now execute the test
name|executeQuery
argument_list|(
name|test
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
specifier|public
name|void
name|testMissingConstrints
parameter_list|()
throws|throws
name|IOException
throws|,
name|JSONException
block|{
name|FieldQueryTestCase
name|test
init|=
operator|new
name|FieldQueryTestCase
argument_list|(
literal|"{"
operator|+
literal|"'selected': [ 'http:\\/\\/www.test.org\\/test#field'], "
operator|+
literal|"'offset': '0', "
operator|+
literal|"'limit': '3', "
operator|+
literal|"}"
argument_list|,
literal|400
argument_list|)
decl_stmt|;
comment|//expect BadRequest
comment|//now execute the test
name|executeQuery
argument_list|(
name|test
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
specifier|public
name|void
name|testEmptyFieldProperty
parameter_list|()
throws|throws
name|IOException
throws|,
name|JSONException
block|{
name|FieldQueryTestCase
name|test
init|=
operator|new
name|FieldQueryTestCase
argument_list|(
literal|"{"
operator|+
literal|"'selected': [ 'http:\\/\\/www.test.org\\/test#field'], "
operator|+
literal|"'constraints': [{ "
operator|+
literal|"'type': 'text', "
operator|+
literal|"'text': 'Paris', "
operator|+
literal|"'patternType' : 'none', "
operator|+
literal|"'field': '', "
operator|+
literal|"'dataTypes': ['http:\\/\\/www.iks-project.eu\\/ontology\\/rick\\/model\\/text'] "
operator|+
literal|"}]"
operator|+
literal|"}"
argument_list|,
literal|400
argument_list|)
decl_stmt|;
comment|//expect BadRequest
comment|//now execute the test
name|executeQuery
argument_list|(
name|test
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
specifier|public
name|void
name|testUnknownConstraintType
parameter_list|()
throws|throws
name|IOException
throws|,
name|JSONException
block|{
name|FieldQueryTestCase
name|test
init|=
operator|new
name|FieldQueryTestCase
argument_list|(
literal|"{"
operator|+
literal|"'selected': [ 'http:\\/\\/www.test.org\\/test#field'], "
operator|+
literal|"'constraints': [{ "
operator|+
literal|"'type': 'unknownConstraintType', "
operator|+
literal|"'test': 'dummy' "
operator|+
literal|"}]"
operator|+
literal|"}"
argument_list|,
literal|400
argument_list|)
decl_stmt|;
comment|//expect BadRequest
comment|//now execute the test
name|executeQuery
argument_list|(
name|test
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
specifier|public
name|void
name|testMultipleConstraintsForSameField
parameter_list|()
throws|throws
name|IOException
throws|,
name|JSONException
block|{
name|FieldQueryTestCase
name|test
init|=
operator|new
name|FieldQueryTestCase
argument_list|(
literal|"{"
operator|+
literal|"'selected': [ 'http:\\/\\/www.test.org\\/test#field'], "
operator|+
literal|"'constraints': [{ "
operator|+
literal|"'type': 'text', "
operator|+
literal|"'text': 'Paris', "
operator|+
literal|"'patternType' : 'none', "
operator|+
literal|"'field': 'http:\\/\\/www.test.org\\/test#field', "
operator|+
literal|"'dataTypes': ['http:\\/\\/www.iks-project.eu\\/ontology\\/rick\\/model\\/text'] "
operator|+
literal|"},{ "
operator|+
literal|"'type': 'reference', "
operator|+
literal|"'field': 'http:\\/\\/www.test.org\\/test#field', "
operator|+
literal|"'value': 'http:\\/\\/dbpedia.org\\/ontology\\/Person', "
operator|+
literal|"}]"
operator|+
literal|"}"
argument_list|,
literal|400
argument_list|)
decl_stmt|;
comment|//expect BadRequest
comment|//now execute the test
name|executeQuery
argument_list|(
name|test
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
specifier|public
name|void
name|testOffsetNoNumber
parameter_list|()
throws|throws
name|IOException
throws|,
name|JSONException
block|{
name|FieldQueryTestCase
name|test
init|=
operator|new
name|FieldQueryTestCase
argument_list|(
literal|"{"
operator|+
literal|"'selected': [ 'http:\\/\\/www.test.org\\/test#field'], "
operator|+
literal|"'offset': 'abc', "
operator|+
literal|"'limit': '3', "
operator|+
literal|"'constraints': [{ "
operator|+
literal|"'type': 'reference', "
operator|+
literal|"'field': 'http:\\/\\/www.test.org\\/test#field', "
operator|+
literal|"'value': 'http:\\/\\/www.test.org\\/test#Test', "
operator|+
literal|"}]"
operator|+
literal|"}"
argument_list|,
literal|400
argument_list|)
decl_stmt|;
comment|//expect BadRequest
comment|//now execute the test
name|executeQuery
argument_list|(
name|test
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
specifier|public
name|void
name|testOffsetNegativeNumber
parameter_list|()
throws|throws
name|IOException
throws|,
name|JSONException
block|{
name|FieldQueryTestCase
name|test
init|=
operator|new
name|FieldQueryTestCase
argument_list|(
literal|"{"
operator|+
literal|"'selected': [ 'http:\\/\\/www.test.org\\/test#field'], "
operator|+
literal|"'offset': '-3', "
operator|+
literal|"'limit': '3', "
operator|+
literal|"'constraints': [{ "
operator|+
literal|"'type': 'reference', "
operator|+
literal|"'field': 'http:\\/\\/www.test.org\\/test#non-existing-field', "
operator|+
literal|"'value': 'http:\\/\\/www.test.org\\/test#NonExistingValue', "
operator|+
literal|"}]"
operator|+
literal|"}"
argument_list|,
literal|false
argument_list|)
decl_stmt|;
comment|//success but no result
comment|//now execute the test
name|RequestExecutor
name|re
init|=
name|executeQuery
argument_list|(
name|test
argument_list|)
decl_stmt|;
name|JSONObject
name|jQuery
init|=
name|assertResponseQuery
argument_list|(
name|re
operator|.
name|getContent
argument_list|()
argument_list|)
decl_stmt|;
name|assertTrue
argument_list|(
literal|"Result Query does not contain offset property"
argument_list|,
name|jQuery
operator|.
name|has
argument_list|(
literal|"offset"
argument_list|)
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
literal|"Returned offset is != 0"
argument_list|,
name|jQuery
operator|.
name|getInt
argument_list|(
literal|"offset"
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
specifier|public
name|void
name|testLimitNoNumber
parameter_list|()
throws|throws
name|IOException
throws|,
name|JSONException
block|{
name|FieldQueryTestCase
name|test
init|=
operator|new
name|FieldQueryTestCase
argument_list|(
literal|"{"
operator|+
literal|"'selected': [ 'http:\\/\\/www.test.org\\/test#field'], "
operator|+
literal|"'offset': '0', "
operator|+
literal|"'limit': 'abc', "
operator|+
literal|"'constraints': [{ "
operator|+
literal|"'type': 'reference', "
operator|+
literal|"'field': 'http:\\/\\/www.test.org\\/test#field', "
operator|+
literal|"'value': 'http:\\/\\/www.test.org\\/test#Test', "
operator|+
literal|"}]"
operator|+
literal|"}"
argument_list|,
literal|400
argument_list|)
decl_stmt|;
comment|//expect BadRequest
comment|//now execute the test
name|executeQuery
argument_list|(
name|test
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
specifier|public
name|void
name|testLimitNegativeNumber
parameter_list|()
throws|throws
name|IOException
throws|,
name|JSONException
block|{
name|FieldQueryTestCase
name|test
init|=
operator|new
name|FieldQueryTestCase
argument_list|(
literal|"{"
operator|+
literal|"'selected': [ 'http:\\/\\/www.test.org\\/test#field'], "
operator|+
literal|"'offset': '0', "
operator|+
literal|"'limit': '-1', "
operator|+
literal|"'constraints': [{ "
operator|+
literal|"'type': 'reference', "
operator|+
literal|"'field': 'http:\\/\\/www.test.org\\/test#non-existing-field', "
operator|+
literal|"'value': 'http:\\/\\/www.test.org\\/test#NonExistingValue', "
operator|+
literal|"}]"
operator|+
literal|"}"
argument_list|,
literal|false
argument_list|)
decl_stmt|;
comment|//success but no result
comment|//now execute the test
name|RequestExecutor
name|re
init|=
name|executeQuery
argument_list|(
name|test
argument_list|)
decl_stmt|;
comment|//test the of the limit was set correctly set to the default (> 0)
name|JSONObject
name|jQuery
init|=
name|assertResponseQuery
argument_list|(
name|re
operator|.
name|getContent
argument_list|()
argument_list|)
decl_stmt|;
name|assertTrue
argument_list|(
literal|"Result Query does not contain Limit property"
argument_list|,
name|jQuery
operator|.
name|has
argument_list|(
literal|"limit"
argument_list|)
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
literal|"Returned limit is<= 0"
argument_list|,
name|jQuery
operator|.
name|getInt
argument_list|(
literal|"limit"
argument_list|)
operator|>
literal|0
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
specifier|public
name|void
name|testMissingConstraintFieldProperty
parameter_list|()
throws|throws
name|IOException
throws|,
name|JSONException
block|{
name|FieldQueryTestCase
name|test
init|=
operator|new
name|FieldQueryTestCase
argument_list|(
literal|"{"
operator|+
literal|"'selected': [ 'http:\\/\\/www.test.org\\/test#field'], "
operator|+
literal|"'constraints': [{ "
operator|+
literal|"'type': 'text', "
operator|+
literal|"'text': 'Paris', "
operator|+
literal|"'patternType' : 'none', "
operator|+
comment|//"'field': 'http:\\/\\/www.test.org\\/test#field', " +
literal|"'dataTypes': ['http:\\/\\/www.iks-project.eu\\/ontology\\/rick\\/model\\/text'] "
operator|+
literal|"}]"
operator|+
literal|"}"
argument_list|,
literal|400
argument_list|)
decl_stmt|;
comment|//expect BadRequest
comment|//now execute the test
name|executeQuery
argument_list|(
name|test
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
specifier|public
name|void
name|testMissingConstraintTypeProperty
parameter_list|()
throws|throws
name|IOException
throws|,
name|JSONException
block|{
name|FieldQueryTestCase
name|test
init|=
operator|new
name|FieldQueryTestCase
argument_list|(
literal|"{"
operator|+
literal|"'selected': [ 'http:\\/\\/www.test.org\\/test#field'], "
operator|+
literal|"'constraints': [{ "
operator|+
comment|//"'type': 'text', " +
literal|"'test': 'dummy' "
operator|+
literal|"}]"
operator|+
literal|"}"
argument_list|,
literal|400
argument_list|)
decl_stmt|;
comment|//expect BadRequest
comment|//now execute the test
name|executeQuery
argument_list|(
name|test
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
specifier|public
name|void
name|testMissingReferenceConstraintValueProperty
parameter_list|()
throws|throws
name|IOException
throws|,
name|JSONException
block|{
name|FieldQueryTestCase
name|test
init|=
operator|new
name|FieldQueryTestCase
argument_list|(
literal|"{"
operator|+
literal|"'selected': [ 'http:\\/\\/www.test.org\\/test#field'], "
operator|+
literal|"'constraints': [{ "
operator|+
literal|"'type': 'reference', "
operator|+
literal|"'field': 'http:\\/\\/www.test.org\\/test#field' "
operator|+
comment|//"'value': 'http:\\/\\/dbpedia.org\\/ontology\\/Person', " +
literal|"}]"
operator|+
literal|"}"
argument_list|,
literal|400
argument_list|)
decl_stmt|;
comment|//expect BadRequest
comment|//now execute the test
name|executeQuery
argument_list|(
name|test
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
specifier|public
name|void
name|testMissinValueConstraintValueProperty
parameter_list|()
throws|throws
name|IOException
throws|,
name|JSONException
block|{
name|FieldQueryTestCase
name|test
init|=
operator|new
name|FieldQueryTestCase
argument_list|(
literal|"{"
operator|+
literal|"'selected': [ 'http:\\/\\/www.test.org\\/test#field'], "
operator|+
literal|"'constraints': [{ "
operator|+
literal|"'type': 'value',"
operator|+
comment|//"'value': 'Paris'," +
literal|"'field': 'http:\\/\\/www.test.org\\/test#field'"
operator|+
literal|"}],"
operator|+
literal|"}"
argument_list|,
literal|400
argument_list|)
decl_stmt|;
comment|//expect BadRequest
comment|//now execute the test
name|executeQuery
argument_list|(
name|test
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
specifier|public
name|void
name|testValueConstraintDefaultDataType
parameter_list|()
throws|throws
name|IOException
throws|,
name|JSONException
block|{
name|FieldQueryTestCase
name|test
init|=
operator|new
name|FieldQueryTestCase
argument_list|(
literal|"{"
operator|+
literal|"'selected': [ 'http:\\/\\/www.test.org\\/test#field'], "
operator|+
literal|"'constraints': [{ "
operator|+
literal|"'type': 'value',"
operator|+
literal|"'value': 'Paris',"
operator|+
literal|"'field': 'http:\\/\\/www.test.org\\/test#field'"
operator|+
literal|"}],"
operator|+
literal|"}"
argument_list|,
literal|false
argument_list|)
decl_stmt|;
comment|//expect BadRequest
comment|//now execute the test
name|RequestExecutor
name|re
init|=
name|executeQuery
argument_list|(
name|test
argument_list|)
decl_stmt|;
name|JSONObject
name|jQuery
init|=
name|assertResponseQuery
argument_list|(
name|re
operator|.
name|getContent
argument_list|()
argument_list|)
decl_stmt|;
name|JSONArray
name|jConstraints
init|=
name|jQuery
operator|.
name|optJSONArray
argument_list|(
literal|"constraints"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
literal|"Result Query does not contain the constraints Array"
argument_list|,
name|jConstraints
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
literal|"Result Query Constraint Array does not contain the expected Constraint"
argument_list|,
name|jConstraints
operator|.
name|length
argument_list|()
operator|==
literal|1
argument_list|)
expr_stmt|;
name|JSONObject
name|jConstraint
init|=
name|jConstraints
operator|.
name|optJSONObject
argument_list|(
literal|0
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
literal|"Constraint Array does not contain JSONObjects"
argument_list|,
name|jConstraint
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
literal|"Returned Query does not contain the default data type"
argument_list|,
name|jConstraint
operator|.
name|has
argument_list|(
literal|"datatype"
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
specifier|public
name|void
name|testMissingTextConstraintTextProperty
parameter_list|()
throws|throws
name|IOException
throws|,
name|JSONException
block|{
name|FieldQueryTestCase
name|test
init|=
operator|new
name|FieldQueryTestCase
argument_list|(
literal|"{"
operator|+
literal|"'selected': [ 'http:\\/\\/www.test.org\\/test#field'], "
operator|+
literal|"'constraints': [{ "
operator|+
literal|"'type': 'text', "
operator|+
comment|//"'text': 'Paris', " +
literal|"'patternType' : 'none', "
operator|+
literal|"'field': 'http:\\/\\/www.test.org\\/test#field', "
operator|+
literal|"}]"
operator|+
literal|"}"
argument_list|,
literal|400
argument_list|)
decl_stmt|;
comment|//expect BadRequest
comment|//now execute the test
name|executeQuery
argument_list|(
name|test
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
specifier|public
name|void
name|testEmptyTextConstraintTextProperty
parameter_list|()
throws|throws
name|IOException
throws|,
name|JSONException
block|{
comment|//1. empty string
name|FieldQueryTestCase
name|test
init|=
operator|new
name|FieldQueryTestCase
argument_list|(
literal|"{"
operator|+
literal|"'selected': [ 'http:\\/\\/www.test.org\\/test#field'], "
operator|+
literal|"'constraints': [{ "
operator|+
literal|"'type': 'text', "
operator|+
literal|"'text': '', "
operator|+
literal|"'patternType' : 'none', "
operator|+
literal|"'field': 'http:\\/\\/www.test.org\\/test#field', "
operator|+
literal|"}]"
operator|+
literal|"}"
argument_list|,
literal|400
argument_list|)
decl_stmt|;
comment|//expect BadRequest
comment|//now execute the test
name|executeQuery
argument_list|(
name|test
argument_list|)
expr_stmt|;
comment|//2 empty Array
name|test
operator|=
operator|new
name|FieldQueryTestCase
argument_list|(
literal|"{"
operator|+
literal|"'selected': [ 'http:\\/\\/www.test.org\\/test#field'], "
operator|+
literal|"'constraints': [{ "
operator|+
literal|"'type': 'text', "
operator|+
literal|"'text': [], "
operator|+
literal|"'patternType' : 'none', "
operator|+
literal|"'field': 'http:\\/\\/www.test.org\\/test#field', "
operator|+
literal|"}]"
operator|+
literal|"}"
argument_list|,
literal|400
argument_list|)
expr_stmt|;
comment|//expect BadRequest
comment|//now execute the test
name|executeQuery
argument_list|(
name|test
argument_list|)
expr_stmt|;
comment|//3 Array with empty string
name|test
operator|=
operator|new
name|FieldQueryTestCase
argument_list|(
literal|"{"
operator|+
literal|"'selected': [ 'http:\\/\\/www.test.org\\/test#field'], "
operator|+
literal|"'constraints': [{ "
operator|+
literal|"'type': 'text', "
operator|+
literal|"'text': [''], "
operator|+
literal|"'patternType' : 'none', "
operator|+
literal|"'field': 'http:\\/\\/www.test.org\\/test#field', "
operator|+
literal|"}]"
operator|+
literal|"}"
argument_list|,
literal|400
argument_list|)
expr_stmt|;
comment|//expect BadRequest
comment|//now execute the test
name|executeQuery
argument_list|(
name|test
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
specifier|public
name|void
name|testDefaultTextConstraintPatternTypeProperty
parameter_list|()
throws|throws
name|IOException
throws|,
name|JSONException
block|{
name|FieldQueryTestCase
name|test
init|=
operator|new
name|FieldQueryTestCase
argument_list|(
literal|"{"
operator|+
literal|"'selected': [ 'http:\\/\\/www.test.org\\/test#field'], "
operator|+
literal|"'constraints': [{ "
operator|+
literal|"'type': 'text', "
operator|+
literal|"'text': 'Paris', "
operator|+
literal|"'field': 'http:\\/\\/www.test.org\\/test#field', "
operator|+
literal|"}]"
operator|+
literal|"}"
argument_list|,
literal|false
argument_list|)
decl_stmt|;
comment|//expect BadRequest
comment|//now execute the test
name|RequestExecutor
name|re
init|=
name|executeQuery
argument_list|(
name|test
argument_list|)
decl_stmt|;
name|JSONObject
name|jQuery
init|=
name|assertResponseQuery
argument_list|(
name|re
operator|.
name|getContent
argument_list|()
argument_list|)
decl_stmt|;
name|JSONArray
name|jConstraints
init|=
name|jQuery
operator|.
name|optJSONArray
argument_list|(
literal|"constraints"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
literal|"Result Query does not contain the constraints Array"
argument_list|,
name|jConstraints
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
literal|"Result Query Constraint Array does not contain the expected Constraint"
argument_list|,
name|jConstraints
operator|.
name|length
argument_list|()
operator|==
literal|1
argument_list|)
expr_stmt|;
name|JSONObject
name|jConstraint
init|=
name|jConstraints
operator|.
name|optJSONObject
argument_list|(
literal|0
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
literal|"Constraint Array does not contain JSONObjects"
argument_list|,
name|jConstraint
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
literal|"The 'patternType' property MUST BE set for returned TextConstraints"
argument_list|,
name|jConstraint
operator|.
name|has
argument_list|(
literal|"patternType"
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"Default for patternType MUST BE 'none'"
argument_list|,
literal|"none"
argument_list|,
name|jConstraint
operator|.
name|getString
argument_list|(
literal|"patternType"
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
specifier|public
name|void
name|testUnknownTextConstraintPatternType
parameter_list|()
throws|throws
name|IOException
throws|,
name|JSONException
block|{
name|FieldQueryTestCase
name|test
init|=
operator|new
name|FieldQueryTestCase
argument_list|(
literal|"{"
operator|+
literal|"'selected': [ 'http:\\/\\/www.test.org\\/test#field'], "
operator|+
literal|"'constraints': [{ "
operator|+
literal|"'type': 'text', "
operator|+
literal|"'text': 'Paris', "
operator|+
literal|"'patternType' : 'unknownPatternType', "
operator|+
literal|"'field': 'http:\\/\\/www.test.org\\/test#field', "
operator|+
literal|"}]"
operator|+
literal|"}"
argument_list|,
literal|400
argument_list|)
decl_stmt|;
comment|//expect BadRequest
comment|//now execute the test
name|executeQuery
argument_list|(
name|test
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
specifier|public
name|void
name|testRangeConstraintNoBoundsProperties
parameter_list|()
throws|throws
name|IOException
throws|,
name|JSONException
block|{
name|FieldQueryTestCase
name|test
init|=
operator|new
name|FieldQueryTestCase
argument_list|(
literal|"{"
operator|+
literal|"'selected': [ 'http:\\/\\/www.test.org\\/test#field'], "
operator|+
literal|"'constraints': [{ "
operator|+
literal|"'type': 'range', "
operator|+
literal|"'field': 'http:\\/\\/www.test.org\\/test#field',"
operator|+
comment|//"'lowerBound': '1946-01-01T00:00:00.000Z'," +
comment|//"'upperBound': '1946-12-31T23:59:59.999Z'," +
literal|"'inclusive': true,"
operator|+
literal|"'datatype': 'xsd:dateTime'"
operator|+
literal|"}]"
operator|+
literal|"}"
argument_list|,
literal|400
argument_list|)
decl_stmt|;
comment|//expect BadRequest
comment|//now execute the test
name|executeQuery
argument_list|(
name|test
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
specifier|public
name|void
name|testDefaultRangeConstraintDatatypeProperty
parameter_list|()
throws|throws
name|IOException
throws|,
name|JSONException
block|{
name|FieldQueryTestCase
name|test
init|=
operator|new
name|FieldQueryTestCase
argument_list|(
literal|"{"
operator|+
literal|"'selected': [ 'http:\\/\\/www.test.org\\/test#field'], "
operator|+
literal|"'constraints': [{ "
operator|+
literal|"'type': 'range', "
operator|+
literal|"'field': 'http:\\/\\/www.test.org\\/test#field', "
operator|+
literal|"'lowerBound': 1000,"
operator|+
literal|"'inclusive': true,"
operator|+
literal|"}]"
operator|+
literal|"}"
argument_list|,
literal|false
argument_list|)
decl_stmt|;
comment|//expect BadRequest
comment|//now execute the test
name|RequestExecutor
name|re
init|=
name|executeQuery
argument_list|(
name|test
argument_list|)
decl_stmt|;
name|JSONObject
name|jQuery
init|=
name|assertResponseQuery
argument_list|(
name|re
operator|.
name|getContent
argument_list|()
argument_list|)
decl_stmt|;
name|JSONArray
name|jConstraints
init|=
name|jQuery
operator|.
name|optJSONArray
argument_list|(
literal|"constraints"
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
literal|"Result Query does not contain the constraints Array"
argument_list|,
name|jConstraints
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
literal|"Result Query Constraint Array does not contain the expected Constraint"
argument_list|,
name|jConstraints
operator|.
name|length
argument_list|()
operator|==
literal|1
argument_list|)
expr_stmt|;
name|JSONObject
name|jConstraint
init|=
name|jConstraints
operator|.
name|optJSONObject
argument_list|(
literal|0
argument_list|)
decl_stmt|;
name|assertNotNull
argument_list|(
literal|"Constraint Array does not contain JSONObjects"
argument_list|,
name|jConstraint
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
literal|"Returned Query does not contain the default data type"
argument_list|,
name|jConstraint
operator|.
name|has
argument_list|(
literal|"datatype"
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_class

end_unit

