begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_package
package|package
name|org
operator|.
name|apache
operator|.
name|stanbol
operator|.
name|entityhub
operator|.
name|web
operator|.
name|writer
operator|.
name|sesame
package|;
end_package

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|OutputStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|ArrayList
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Arrays
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Collection
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Collections
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|LinkedHashSet
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|ws
operator|.
name|rs
operator|.
name|WebApplicationException
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|ws
operator|.
name|rs
operator|.
name|core
operator|.
name|MediaType
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|felix
operator|.
name|scr
operator|.
name|annotations
operator|.
name|Activate
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|felix
operator|.
name|scr
operator|.
name|annotations
operator|.
name|Component
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|felix
operator|.
name|scr
operator|.
name|annotations
operator|.
name|Deactivate
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|felix
operator|.
name|scr
operator|.
name|annotations
operator|.
name|Reference
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|felix
operator|.
name|scr
operator|.
name|annotations
operator|.
name|ReferenceCardinality
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|felix
operator|.
name|scr
operator|.
name|annotations
operator|.
name|Service
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|stanbol
operator|.
name|commons
operator|.
name|namespaceprefix
operator|.
name|NamespacePrefixService
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|stanbol
operator|.
name|entityhub
operator|.
name|model
operator|.
name|sesame
operator|.
name|RdfRepresentation
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|stanbol
operator|.
name|entityhub
operator|.
name|model
operator|.
name|sesame
operator|.
name|RdfValueFactory
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|stanbol
operator|.
name|entityhub
operator|.
name|servicesapi
operator|.
name|defaults
operator|.
name|NamespaceEnum
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|stanbol
operator|.
name|entityhub
operator|.
name|servicesapi
operator|.
name|model
operator|.
name|Entity
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|stanbol
operator|.
name|entityhub
operator|.
name|servicesapi
operator|.
name|model
operator|.
name|Representation
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|stanbol
operator|.
name|entityhub
operator|.
name|servicesapi
operator|.
name|model
operator|.
name|rdf
operator|.
name|RdfResourceEnum
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|stanbol
operator|.
name|entityhub
operator|.
name|servicesapi
operator|.
name|query
operator|.
name|FieldQuery
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|stanbol
operator|.
name|entityhub
operator|.
name|servicesapi
operator|.
name|query
operator|.
name|QueryResultList
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|stanbol
operator|.
name|entityhub
operator|.
name|web
operator|.
name|ModelWriter
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|stanbol
operator|.
name|entityhub
operator|.
name|web
operator|.
name|fieldquery
operator|.
name|FieldQueryToJsonUtils
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|stanbol
operator|.
name|entityhub
operator|.
name|yard
operator|.
name|sesame
operator|.
name|SesameQueryResultList
import|;
end_import

begin_import
import|import
name|org
operator|.
name|codehaus
operator|.
name|jettison
operator|.
name|json
operator|.
name|JSONException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|codehaus
operator|.
name|jettison
operator|.
name|json
operator|.
name|JSONObject
import|;
end_import

begin_import
import|import
name|org
operator|.
name|openrdf
operator|.
name|model
operator|.
name|Literal
import|;
end_import

begin_import
import|import
name|org
operator|.
name|openrdf
operator|.
name|model
operator|.
name|Model
import|;
end_import

begin_import
import|import
name|org
operator|.
name|openrdf
operator|.
name|model
operator|.
name|URI
import|;
end_import

begin_import
import|import
name|org
operator|.
name|openrdf
operator|.
name|model
operator|.
name|ValueFactory
import|;
end_import

begin_import
import|import
name|org
operator|.
name|openrdf
operator|.
name|model
operator|.
name|impl
operator|.
name|LinkedHashModel
import|;
end_import

begin_import
import|import
name|org
operator|.
name|openrdf
operator|.
name|model
operator|.
name|impl
operator|.
name|ValueFactoryImpl
import|;
end_import

begin_import
import|import
name|org
operator|.
name|openrdf
operator|.
name|rio
operator|.
name|RDFFormat
import|;
end_import

begin_import
import|import
name|org
operator|.
name|openrdf
operator|.
name|rio
operator|.
name|RDFHandlerException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|openrdf
operator|.
name|rio
operator|.
name|Rio
import|;
end_import

begin_import
import|import
name|org
operator|.
name|osgi
operator|.
name|service
operator|.
name|component
operator|.
name|ComponentContext
import|;
end_import

begin_import
import|import
name|org
operator|.
name|slf4j
operator|.
name|Logger
import|;
end_import

begin_import
import|import
name|org
operator|.
name|slf4j
operator|.
name|LoggerFactory
import|;
end_import

begin_class
annotation|@
name|Component
argument_list|(
name|immediate
operator|=
literal|true
argument_list|)
annotation|@
name|Service
specifier|public
class|class
name|SesameModelWriter
implements|implements
name|ModelWriter
block|{
specifier|private
specifier|static
specifier|final
name|Logger
name|log
init|=
name|LoggerFactory
operator|.
name|getLogger
argument_list|(
name|SesameModelWriter
operator|.
name|class
argument_list|)
decl_stmt|;
specifier|private
specifier|final
specifier|static
name|RdfValueFactory
name|valueFactory
init|=
name|RdfValueFactory
operator|.
name|getInstance
argument_list|()
decl_stmt|;
specifier|private
specifier|final
specifier|static
name|ValueFactory
name|sesameFactory
init|=
name|ValueFactoryImpl
operator|.
name|getInstance
argument_list|()
decl_stmt|;
specifier|private
specifier|final
specifier|static
name|URI
name|FOAF_DOCUMENT
init|=
name|sesameFactory
operator|.
name|createURI
argument_list|(
name|NamespaceEnum
operator|.
name|foaf
operator|+
literal|"Document"
argument_list|)
decl_stmt|;
specifier|private
specifier|final
specifier|static
name|URI
name|FOAF_PRIMARY_TOPIC
init|=
name|sesameFactory
operator|.
name|createURI
argument_list|(
name|NamespaceEnum
operator|.
name|foaf
operator|+
literal|"primaryTopic"
argument_list|)
decl_stmt|;
specifier|private
specifier|final
specifier|static
name|URI
name|FOAF_PRIMARY_TOPIC_OF
init|=
name|sesameFactory
operator|.
name|createURI
argument_list|(
name|NamespaceEnum
operator|.
name|foaf
operator|+
literal|"isPrimaryTopicOf"
argument_list|)
decl_stmt|;
specifier|private
specifier|final
specifier|static
name|URI
name|RDF_TYPE
init|=
name|sesameFactory
operator|.
name|createURI
argument_list|(
name|NamespaceEnum
operator|.
name|rdf
operator|+
literal|"type"
argument_list|)
decl_stmt|;
specifier|private
specifier|final
specifier|static
name|URI
name|EH_SIGN_SITE
init|=
name|sesameFactory
operator|.
name|createURI
argument_list|(
name|RdfResourceEnum
operator|.
name|site
operator|.
name|getUri
argument_list|()
argument_list|)
decl_stmt|;
comment|/**      * The URI used for the query result list (static for all responses)      */
specifier|private
specifier|static
specifier|final
name|URI
name|QUERY_RESULT_LIST
init|=
name|sesameFactory
operator|.
name|createURI
argument_list|(
name|RdfResourceEnum
operator|.
name|QueryResultSet
operator|.
name|getUri
argument_list|()
argument_list|)
decl_stmt|;
comment|/**      * The property used for all results      */
specifier|private
specifier|static
specifier|final
name|URI
name|QUERY_RESULT
init|=
name|sesameFactory
operator|.
name|createURI
argument_list|(
name|RdfResourceEnum
operator|.
name|queryResult
operator|.
name|getUri
argument_list|()
argument_list|)
decl_stmt|;
comment|/**      * The property used for the JSON serialised FieldQuery (STANBOL-298)      */
specifier|private
specifier|static
specifier|final
name|URI
name|FIELD_QUERY
init|=
name|sesameFactory
operator|.
name|createURI
argument_list|(
name|RdfResourceEnum
operator|.
name|query
operator|.
name|getUri
argument_list|()
argument_list|)
decl_stmt|;
annotation|@
name|Reference
argument_list|(
name|cardinality
operator|=
name|ReferenceCardinality
operator|.
name|OPTIONAL_UNARY
argument_list|)
name|NamespacePrefixService
name|nsPrefixService
decl_stmt|;
comment|/**      * The list with the supported {@link MediaType}s as provided by the      * Sesame {@link RDFFormat} class      */
specifier|private
name|List
argument_list|<
name|MediaType
argument_list|>
name|supportedRrfFormats
decl_stmt|;
annotation|@
name|Activate
specifier|protected
name|void
name|activate
parameter_list|(
name|ComponentContext
name|ctx
parameter_list|)
block|{
comment|//parse the supported RDF formats
name|Collection
argument_list|<
name|String
argument_list|>
name|mts
init|=
operator|new
name|LinkedHashSet
argument_list|<
name|String
argument_list|>
argument_list|()
decl_stmt|;
for|for
control|(
name|RDFFormat
name|format
range|:
name|RDFFormat
operator|.
name|values
argument_list|()
control|)
block|{
name|mts
operator|.
name|addAll
argument_list|(
name|format
operator|.
name|getMIMETypes
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|List
argument_list|<
name|MediaType
argument_list|>
name|formats
init|=
operator|new
name|ArrayList
argument_list|<
name|MediaType
argument_list|>
argument_list|(
name|mts
operator|.
name|size
argument_list|()
argument_list|)
decl_stmt|;
for|for
control|(
name|String
name|format
range|:
name|mts
control|)
block|{
try|try
block|{
name|formats
operator|.
name|add
argument_list|(
name|MediaType
operator|.
name|valueOf
argument_list|(
name|format
argument_list|)
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IllegalArgumentException
name|e
parameter_list|)
block|{
name|log
operator|.
name|error
argument_list|(
literal|"Unable to parse MediaType for Sesame RDF format '"
operator|+
name|format
operator|+
literal|"'!"
argument_list|,
name|e
argument_list|)
expr_stmt|;
block|}
block|}
name|supportedRrfFormats
operator|=
name|Collections
operator|.
name|unmodifiableList
argument_list|(
name|formats
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Deactivate
specifier|protected
name|void
name|deactivate
parameter_list|(
name|ComponentContext
name|ctx
parameter_list|)
block|{
name|supportedRrfFormats
operator|=
literal|null
expr_stmt|;
block|}
annotation|@
name|Override
specifier|public
name|Class
argument_list|<
name|?
extends|extends
name|Representation
argument_list|>
name|getNativeType
parameter_list|()
block|{
return|return
name|RdfRepresentation
operator|.
name|class
return|;
block|}
annotation|@
name|Override
specifier|public
name|List
argument_list|<
name|MediaType
argument_list|>
name|supportedMediaTypes
parameter_list|()
block|{
return|return
name|supportedRrfFormats
return|;
block|}
annotation|@
name|Override
specifier|public
name|MediaType
name|getBestMediaType
parameter_list|(
name|MediaType
name|mediaType
parameter_list|)
block|{
for|for
control|(
name|MediaType
name|supported
range|:
name|supportedRrfFormats
control|)
block|{
if|if
condition|(
name|supported
operator|.
name|isCompatible
argument_list|(
name|mediaType
argument_list|)
condition|)
block|{
return|return
name|supported
return|;
block|}
block|}
return|return
literal|null
return|;
block|}
annotation|@
name|Override
specifier|public
name|void
name|write
parameter_list|(
name|Representation
name|rep
parameter_list|,
name|OutputStream
name|out
parameter_list|,
name|MediaType
name|mediaType
parameter_list|)
throws|throws
name|WebApplicationException
throws|,
name|IOException
block|{
name|writeRdf
argument_list|(
name|toRDF
argument_list|(
name|rep
argument_list|)
argument_list|,
name|out
argument_list|,
name|mediaType
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
specifier|public
name|void
name|write
parameter_list|(
name|Entity
name|entity
parameter_list|,
name|OutputStream
name|out
parameter_list|,
name|MediaType
name|mediaType
parameter_list|)
throws|throws
name|WebApplicationException
throws|,
name|IOException
block|{
name|writeRdf
argument_list|(
name|toRDF
argument_list|(
name|entity
argument_list|)
argument_list|,
name|out
argument_list|,
name|mediaType
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
specifier|public
name|void
name|write
parameter_list|(
name|QueryResultList
argument_list|<
name|?
argument_list|>
name|result
parameter_list|,
name|OutputStream
name|out
parameter_list|,
name|MediaType
name|mediaType
parameter_list|)
throws|throws
name|WebApplicationException
throws|,
name|IOException
block|{
name|Model
name|queryRdf
init|=
name|toRDF
argument_list|(
name|result
argument_list|)
decl_stmt|;
comment|//we need also to the JSON formatted FieldQuery as a literal to the
comment|//RDF data.
name|FieldQuery
name|query
init|=
name|result
operator|.
name|getQuery
argument_list|()
decl_stmt|;
if|if
condition|(
name|query
operator|!=
literal|null
condition|)
block|{
try|try
block|{
name|JSONObject
name|fieldQueryJson
init|=
name|FieldQueryToJsonUtils
operator|.
name|toJSON
argument_list|(
name|query
argument_list|,
name|nsPrefixService
argument_list|)
decl_stmt|;
if|if
condition|(
name|fieldQueryJson
operator|!=
literal|null
condition|)
block|{
comment|//add the triple with the fieldQuery
name|queryRdf
operator|.
name|add
argument_list|(
name|QUERY_RESULT_LIST
argument_list|,
name|FIELD_QUERY
argument_list|,
name|sesameFactory
operator|.
name|createLiteral
argument_list|(
name|fieldQueryJson
operator|.
name|toString
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
catch|catch
parameter_list|(
name|JSONException
name|e
parameter_list|)
block|{
name|log
operator|.
name|warn
argument_list|(
name|String
operator|.
name|format
argument_list|(
literal|"Unable to serialize Fieldquery '%s' to JSON! "
operator|+
literal|"Query response will not contain the serialized query."
argument_list|,
name|query
argument_list|)
argument_list|,
name|e
argument_list|)
expr_stmt|;
block|}
block|}
comment|//now serialise the data
name|writeRdf
argument_list|(
name|queryRdf
argument_list|,
name|out
argument_list|,
name|mediaType
argument_list|)
expr_stmt|;
block|}
comment|/**      * @param data      * @param out      * @param mediaType      */
specifier|private
name|void
name|writeRdf
parameter_list|(
name|Model
name|data
parameter_list|,
name|OutputStream
name|out
parameter_list|,
name|MediaType
name|mediaType
parameter_list|)
block|{
name|RDFFormat
name|rdfFormat
init|=
name|Rio
operator|.
name|getWriterFormatForMIMEType
argument_list|(
name|mediaType
operator|.
name|toString
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
name|rdfFormat
operator|==
literal|null
condition|)
block|{
throw|throw
operator|new
name|IllegalStateException
argument_list|(
literal|"JAX-RS called for unsupported mediaType '"
operator|+
name|mediaType
operator|+
literal|"'! If this is a valid RDF type this indicates a missing "
operator|+
literal|"Sesame Serializer implementation. Otherwise please report this "
operator|+
literal|"as a bug for the Stanbol Issue Tracker."
argument_list|)
throw|;
block|}
try|try
block|{
name|Rio
operator|.
name|write
argument_list|(
name|data
argument_list|,
name|out
argument_list|,
name|rdfFormat
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|RDFHandlerException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|WebApplicationException
argument_list|(
literal|"Unable to serialize QueryResultList with requested Format '"
operator|+
name|rdfFormat
operator|+
literal|"'!"
argument_list|,
name|e
argument_list|)
throw|;
block|}
block|}
specifier|private
name|Model
name|toRDF
parameter_list|(
name|Representation
name|representation
parameter_list|)
block|{
return|return
name|valueFactory
operator|.
name|toRdfRepresentation
argument_list|(
name|representation
argument_list|)
operator|.
name|getModel
argument_list|()
return|;
block|}
specifier|private
name|void
name|addRDFTo
parameter_list|(
name|Model
name|graph
parameter_list|,
name|Representation
name|representation
parameter_list|)
block|{
name|graph
operator|.
name|addAll
argument_list|(
name|valueFactory
operator|.
name|toRdfRepresentation
argument_list|(
name|representation
argument_list|)
operator|.
name|getModel
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|private
name|Model
name|toRDF
parameter_list|(
name|Entity
name|entity
parameter_list|)
block|{
name|Model
name|graph
init|=
operator|new
name|LinkedHashModel
argument_list|()
decl_stmt|;
name|addRDFTo
argument_list|(
name|graph
argument_list|,
name|entity
argument_list|)
expr_stmt|;
return|return
name|graph
return|;
block|}
specifier|private
name|void
name|addRDFTo
parameter_list|(
name|Model
name|graph
parameter_list|,
name|Entity
name|entity
parameter_list|)
block|{
name|addRDFTo
argument_list|(
name|graph
argument_list|,
name|entity
operator|.
name|getRepresentation
argument_list|()
argument_list|)
expr_stmt|;
name|addRDFTo
argument_list|(
name|graph
argument_list|,
name|entity
operator|.
name|getMetadata
argument_list|()
argument_list|)
expr_stmt|;
comment|//now add some triples that represent the Sign
name|addEntityTriplesToGraph
argument_list|(
name|graph
argument_list|,
name|entity
argument_list|)
expr_stmt|;
block|}
comment|/**      * Adds the Triples that represent the Sign to the parsed graph. Note that      * this method does not add triples for the representation. However it adds      * the triple (sign,singRepresentation,representation)      *      * @param graph the graph to add the triples      * @param sign the sign      */
specifier|private
name|void
name|addEntityTriplesToGraph
parameter_list|(
name|Model
name|graph
parameter_list|,
name|Entity
name|sign
parameter_list|)
block|{
name|URI
name|id
init|=
name|sesameFactory
operator|.
name|createURI
argument_list|(
name|sign
operator|.
name|getId
argument_list|()
argument_list|)
decl_stmt|;
name|URI
name|metaId
init|=
name|sesameFactory
operator|.
name|createURI
argument_list|(
name|sign
operator|.
name|getMetadata
argument_list|()
operator|.
name|getId
argument_list|()
argument_list|)
decl_stmt|;
comment|//add the FOAF triples between metadata and content
name|graph
operator|.
name|add
argument_list|(
name|id
argument_list|,
name|FOAF_PRIMARY_TOPIC_OF
argument_list|,
name|metaId
argument_list|)
expr_stmt|;
name|graph
operator|.
name|add
argument_list|(
name|metaId
argument_list|,
name|FOAF_PRIMARY_TOPIC
argument_list|,
name|metaId
argument_list|)
expr_stmt|;
name|graph
operator|.
name|add
argument_list|(
name|metaId
argument_list|,
name|RDF_TYPE
argument_list|,
name|FOAF_DOCUMENT
argument_list|)
expr_stmt|;
comment|//add the site to the metadata
comment|//TODO: this should be the HTTP URI and not the id of the referenced site
name|Literal
name|siteName
init|=
name|sesameFactory
operator|.
name|createLiteral
argument_list|(
name|sign
operator|.
name|getSite
argument_list|()
argument_list|)
decl_stmt|;
name|graph
operator|.
name|add
argument_list|(
name|metaId
argument_list|,
name|EH_SIGN_SITE
argument_list|,
name|siteName
argument_list|)
expr_stmt|;
block|}
specifier|private
name|Model
name|toRDF
parameter_list|(
name|QueryResultList
argument_list|<
name|?
argument_list|>
name|resultList
parameter_list|)
block|{
specifier|final
name|Model
name|resultGraph
decl_stmt|;
name|Class
argument_list|<
name|?
argument_list|>
name|type
init|=
name|resultList
operator|.
name|getType
argument_list|()
decl_stmt|;
if|if
condition|(
name|String
operator|.
name|class
operator|.
name|isAssignableFrom
argument_list|(
name|type
argument_list|)
condition|)
block|{
name|resultGraph
operator|=
operator|new
name|LinkedHashModel
argument_list|()
expr_stmt|;
comment|//create a new Graph
for|for
control|(
name|Object
name|result
range|:
name|resultList
control|)
block|{
comment|//add a triple to each reference in the result set
name|resultGraph
operator|.
name|add
argument_list|(
name|QUERY_RESULT_LIST
argument_list|,
name|QUERY_RESULT
argument_list|,
name|sesameFactory
operator|.
name|createURI
argument_list|(
name|result
operator|.
name|toString
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
comment|//first determine the type of the resultList
specifier|final
name|boolean
name|isSignType
decl_stmt|;
if|if
condition|(
name|Representation
operator|.
name|class
operator|.
name|isAssignableFrom
argument_list|(
name|type
argument_list|)
condition|)
block|{
name|isSignType
operator|=
literal|false
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|Representation
operator|.
name|class
operator|.
name|isAssignableFrom
argument_list|(
name|type
argument_list|)
condition|)
block|{
name|isSignType
operator|=
literal|true
expr_stmt|;
block|}
else|else
block|{
comment|//incompatible type -> throw an Exception
throw|throw
operator|new
name|IllegalArgumentException
argument_list|(
literal|"Parsed type "
operator|+
name|type
operator|+
literal|" is not supported"
argument_list|)
throw|;
block|}
comment|//special treatment for RdfQueryResultList for increased performance
if|if
condition|(
name|resultList
operator|instanceof
name|SesameQueryResultList
condition|)
block|{
name|resultGraph
operator|=
operator|(
operator|(
name|SesameQueryResultList
operator|)
name|resultList
operator|)
operator|.
name|getModel
argument_list|()
expr_stmt|;
if|if
condition|(
name|isSignType
condition|)
block|{
comment|//if we build a ResultList for Signs, we need to do more things
comment|//first remove all triples representing results
name|resultGraph
operator|.
name|filter
argument_list|(
literal|null
argument_list|,
name|QUERY_RESULT
argument_list|,
literal|null
argument_list|)
operator|.
name|clear
argument_list|()
expr_stmt|;
comment|//now add the Sign specific triples and add result triples
comment|//to the Sign IDs
for|for
control|(
name|Object
name|result
range|:
name|resultList
control|)
block|{
name|URI
name|signId
init|=
name|sesameFactory
operator|.
name|createURI
argument_list|(
operator|(
operator|(
name|Entity
operator|)
name|result
operator|)
operator|.
name|getId
argument_list|()
argument_list|)
decl_stmt|;
name|addEntityTriplesToGraph
argument_list|(
name|resultGraph
argument_list|,
operator|(
name|Entity
operator|)
name|result
argument_list|)
expr_stmt|;
name|resultGraph
operator|.
name|add
argument_list|(
name|QUERY_RESULT_LIST
argument_list|,
name|QUERY_RESULT
argument_list|,
name|signId
argument_list|)
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
comment|//any other implementation of the QueryResultList interface
name|resultGraph
operator|=
operator|new
name|LinkedHashModel
argument_list|()
expr_stmt|;
comment|//create a new graph
if|if
condition|(
name|Representation
operator|.
name|class
operator|.
name|isAssignableFrom
argument_list|(
name|type
argument_list|)
condition|)
block|{
for|for
control|(
name|Object
name|result
range|:
name|resultList
control|)
block|{
name|URI
name|resultId
decl_stmt|;
if|if
condition|(
operator|!
name|isSignType
condition|)
block|{
name|addRDFTo
argument_list|(
name|resultGraph
argument_list|,
operator|(
name|Representation
operator|)
name|result
argument_list|)
expr_stmt|;
name|resultId
operator|=
name|sesameFactory
operator|.
name|createURI
argument_list|(
operator|(
operator|(
name|Representation
operator|)
name|result
operator|)
operator|.
name|getId
argument_list|()
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|addRDFTo
argument_list|(
name|resultGraph
argument_list|,
operator|(
name|Entity
operator|)
name|result
argument_list|)
expr_stmt|;
name|resultId
operator|=
name|sesameFactory
operator|.
name|createURI
argument_list|(
operator|(
operator|(
name|Entity
operator|)
name|result
operator|)
operator|.
name|getId
argument_list|()
argument_list|)
expr_stmt|;
block|}
comment|//Note: In case of Representation this Triple points to
comment|//      the representation. In case of Signs it points to
comment|//      the sign.
name|resultGraph
operator|.
name|add
argument_list|(
name|QUERY_RESULT_LIST
argument_list|,
name|QUERY_RESULT
argument_list|,
name|resultId
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
return|return
name|resultGraph
return|;
block|}
block|}
end_class

end_unit

